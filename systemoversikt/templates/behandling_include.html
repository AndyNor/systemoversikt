{% load static %}

<table id="behandlinger" class="tablesorter">
	<thead>
		<tr>
			{% if user.is_authenticated %}
			<th class="filter-false">Rediger</th>
			{% endif %}
			{% comment %}<th>Virksomhet</th>{% endcomment %}
			<th>Hovedoppgave / Hovedformål</th>
			<th>Avdeling</th>
			<th>Behandlingen</th>
			<th>Formål</th>
			<th>Den registrerte</th>
			<th>Opplysninger</th>
			{% comment %}<th>Fellesbehandling?</th>{% endcomment %}
			{% comment %}<th>Krav sikkerhetsnivå</th>{% endcomment %}
			<th>Behov for DPIA?</th>
			<th>Systemer og programvarer</th>
			<th>Eksterne databehandlere</th>
			{% if user.is_authenticated %}
			<th class="filter-false">Slett</th>
			{% endif %}
		</tr>
	</thead>
	<tbody>
		{% for item in behandlinger %}
		<tr>
			{% if user.is_authenticated %}
			<td><a href="/admin/systemoversikt/behandlingerpersonopplysninger/{{ item.pk }}/change/">{% include 'site_edit_button.html' %}</a></td>
			{% endif %}

			{% comment %}
			{% url "virksomhet" item.behandlingsansvarlig.pk as url_virksomhet %}
			<td><a href="{{ url_virksomhet }}">{{ item.behandlingsansvarlig.virksomhetsforkortelse }}</a></td>
			{% endcomment %}

			<td>{{ item.funksjonsomraade|default:"?" }}</td>

			<td>{{ item.internt_ansvarlig|default:"?" }}</td>

			<td>
			{% if perms.systemoversikt.view_behandlingerpersonopplysninger %}
				{% if item.informasjon_kvalitetssikret is False %}
				<img style="width: 11px; filter: invert(30%) sepia(150%) saturate(500%) hue-rotate(300deg);" src="{% static 'open-iconic/svg/warning.svg' %}" alt="Kvalitet ikke verifisert">
				{% endif %}
			{% url "behandlingsdetaljer" item.pk as url_behandlingsdetaljer %}
			<a href="{{ url_behandlingsdetaljer }}">{{ item.behandlingen }}</a>
			{% else %}
				***
			{% endif %}
			</td>

			<td>
			{% if perms.systemoversikt.view_behandlingerpersonopplysninger %}
				{{ item.formaal }}
			{% else %}
				***
			{% endif %}
			</td>

			<td>
			{% if perms.systemoversikt.view_behandlingerpersonopplysninger %}
				<ul>
				{% for reg in item.den_registrerte.all %}
					<li>{{ reg.kategorinavn }}</li>
				{% endfor %}
				</ul>
			{% else %}
				***
			{% endif %}
			</td>

			<td>
			{% if perms.systemoversikt.view_behandlingerpersonopplysninger %}
				<ul>
				{% for kat in item.kategorier_personopplysninger.all %}
					<li>{{ kat.navn }}</li>
				{% endfor %}
				</ul>
			{% else %}
				***
			{% endif %}
			</td>

			{% comment %}
			<td>{{ item.fellesbehandling|yesno:"Ja,Nei" }}</td>
			{% endcomment %}

			{% comment %}
			<td>
			{% if perms.systemoversikt.view_behandlingerpersonopplysninger %}
				{{ item.get_krav_sikkerhetsnivaa_display|default:"-" }}
			{% else %}
				***
			{% endif %}
			</td>
			{% endcomment %}

			<td>
			{% if perms.systemoversikt.view_behandlingerpersonopplysninger %}
				Ny vurdering vises ikke enda.<br>
				Gammel vurdering: {{ item.hoy_personvernrisiko|yesno:"Ja,Nei" }}
			{% else %}
				***
			{% endif %}
			</td>

			<td>
				{% for system in item.systemer.all %}
					{% url "systemdetaljer" system.pk as url_programvaredetaljer %}
					<a href="{{ url_programvaredetaljer }}">{{ system }}</a><br>
				{% endfor %}

				{% for program in item.programvarer.all %}
					{% url "programvaredetaljer" program.pk as url_systemdetaljer %}
					<a href="{{ url_systemdetaljer }}">{{ program }}</a><br>
				{% endfor %}
			</td>
			<td>
				{% for databehandler in item.navn_databehandler.all %}
					{% url "leverandor" databehandler.pk as url_leverandor %}
					<a href="{{ url_leverandor }}">{{ databehandler }}</a><br>
				{% endfor %}
			</td>

			{% if user.is_authenticated %}
			<td><a href="/admin/systemoversikt/behandlingerpersonopplysninger/{{ item.pk }}/delete/"><img style="width: 8px; margin: 3px;" src="{% static 'open-iconic/svg/x.svg' %}" alt="slett"></a></td>
			{% endif %}
		</tr>
		{% endfor %}
	</tbody>
</table>
