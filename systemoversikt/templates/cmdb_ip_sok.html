{% extends "cmdb_index.html" %}
{% load humanize %}
{% load static %}

{% block ekstrameny_business_service %}
{% endblock ekstrameny_business_service %}

{% block overskrift %}
	Søk på IP-adresser på felles IKT-plattform
{% endblock overskrift %}

{% block hovedinnhold %}

	<p>Oversikt over ulike nettverksdata på felles IKT-plattform: VLAN, VIP-er i BigIP, NAT-adresser, samt sonefil fra DNS lastes inn i databasen. Alt dette skjer manuelt, men det jobbes med å automatisere.<br>Her kan du søke på IP-adresser, og du vil få treff fra de ulike kildene.</p>

	<p>Du kan lime inn tekst her og IP-adresser vil identifiseres automatisk.</p>

	<form action="{% url 'alle_ip' %}" method="POST" autocomplete="off">
		{% csrf_token %}
		<div class="form-group form-inline">
			<textarea rows="3" cols="50" style="width: 500px; height: 150px;" name="search_term"
			placeholder="Liste med IP-adresser, separert med space, semikolon eller komma. Annen tekst ignoreres..." class="form-control form-control-sm">{{ search_term }}</textarea>
			<input style="margin-left: 10px;" type="submit" value="Slå opp" class="btn btn-primary btn-sm">
		</div>
	</form>

	<hr>
	<p>Oppslag kan ta lang tid dersom mange IP-adresser legges inn.

	<table class="table table-sm tablesorter excel">
	<thead>
		<th>IP</th>
		<th>Host</th>
		<th>DNS intern</th>
		<th>DNS ekstern</th>
		<th>VLAN</th>
		<th>VIP</th>
	</thead>
	<tbody>
	{% for ip in ip_lookup %}
		<tr>
			<td>{{ip.address}}</td>
			<td>
				{% if ip.comp_name %}
					<a href="{% url 'alle_servere' %}?device_search_term={{ip.comp_name}}">{{ip.comp_name}}</a>
				{% endif %}
			</td>
			<td>{{ip.dns_i|default:"Ingen treff"}}</td>
			<td>{{ip.dns_e|default:"Ingen treff"}}</td>
			<td>{{ip.vlan.comment|default:"Ingen treff"}}</td>
			<td>
				{% for v in ip.vip %}
					{{ v.vip_name }}<br>
				{% endfor %}

				{% for p in ip.vip_pool %}
					{% for vip in p.vip.all %}
						{% url 'detaljer_vip' pk=vip.pk as url_vip %}
						<a href="{{url_vip}}">{{ vip.vip_name }}</a><br>
					{% endfor %}
				{% endfor %}
			</td>
		</tr>
	{% endfor %}
	</tbody>
	</table>

{% if not_ip_addresses %}
	<p>Følgende ting er ikke IP-adresser:
	<ul style="column-count:10;">
	{% for item in not_ip_addresses %}
		<li>{{item}}</li>
	{% endfor %}
	</ul>
{% endif %}


{% endblock hovedinnhold %}