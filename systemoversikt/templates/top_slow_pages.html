{% extends "system_index.html" %}
{% load humanize %}
{% load static %}

{% block ekstrameny_business_service %}
{% endblock ekstrameny_business_service %}

{% block overskrift %}
    Top Time Offenders (Last 7 Days)
{% endblock overskrift %}

{% block hovedinnhold %}

<p>
  <strong>Window:</strong>
  {{ summary.from }} â†’ {{ summary.to }} &middot;
  <strong>Min. requests per endpoint:</strong> {{ summary.min_requests }} &middot;
  <strong>Include errors:</strong> {{ summary.include_errors|yesno:"Yes,No" }} &middot;
  <strong>Rows shown:</strong> {{ summary.limit }}<br>
  <strong>Total requests:</strong> {{ summary.total_requests }} &middot;
  <strong>Total duration:</strong> {{ summary.total_duration_ms|floatformat:0 }} ms &middot;
  <strong>Total SQL time:</strong> {{ summary.total_sql_time_ms|floatformat:0 }} ms
</p>

<form method="get" class="form-inline" style="margin-bottom: 1rem;">
  <label>Min requests:&nbsp;
    <input type="number" name="min_requests" value="{{ summary.min_requests }}" min="1" step="10">
  </label>
  &nbsp;&nbsp;
  <label>Include errors:&nbsp;
    <select name="include_errors">
      <option value="0" {% if not summary.include_errors %}selected{% endif %}>No</option>
      <option value="1" {% if summary.include_errors %}selected{% endif %}>Yes</option>
    </select>
  </label>
  &nbsp;&nbsp;
  <label>Limit:&nbsp;
    <input type="number" name="limit" value="{{ summary.limit }}" min="10" step="10">
  </label>
  &nbsp;&nbsp;
  <button type="submit" class="btn btn-primary btn-sm">Apply</button>
</form>

<table class="table table-striped table-sm">
  <thead>
    <tr>
      <th>Path</th>
      <th>Method</th>
      <th>Requests</th>
      <th>Avg Duration (ms)</th>
      <th>Max Duration (ms)</th>
      <th>Total Duration (ms)</th>
      <th>Avg SQL Queries</th>
      <th>Total SQL Time (ms)</th>
    </tr>
  </thead>
  <tbody>
    {% for r in rows %}
    <tr>
      <td><code>{{ r.path }}</code></td>
      <td>{{ r.method }}</td>
      <td>{{ r.requests }}</td>
      <td>{{ r.avg_duration|floatformat:2 }}</td>
      <td>{{ r.max_duration|floatformat:2 }}</td>
      <td><strong>{{ r.total_duration|floatformat:0 }}</strong></td>
      <td>{{ r.avg_sql_queries|floatformat:2 }}</td>
      <td>{{ r.total_sql_time|floatformat:0 }}</td>
    </tr>
    {% endfor %}
  </tbody>
</table>

{% endblock hovedinnhold %}
