{% extends "cmdb_index.html" %}
{% load humanize %}
{% load static %}
{% load l10n %}

{% block overskrift %}
	Tilgangsgrupper i Active Directory
{% endblock overskrift %}

{% block ekstrajavascript %}
	<script src="https://cdn.jsdelivr.net/npm/chart.js" nonce="{{request.csp_nonce}}"></script>
{% endblock ekstrajavascript %}


{% block hovedinnhold %}

	{% url 'ad_analyse' as url_ad_analyse %}
	<a href="{{ url_ad_analyse }}?antall=0" class="btn btn-sm btn-link {% if url_ad_analyse in request.path %}fremhev{% endif %}">Tomme sikkerhetsgrupper</a>

	{% url 'ad' as url_ad %}
	<a href="{{url_ad}}" class="btn btn-sm {% if url_ad in request.path %}fremhev{% endif %}">Innebygde roller</a>

	<hr>

	<div><canvas height="80" id="adgr_chart"></canvas></div>

	<script type="text/javascript" nonce="{{request.csp_nonce}}">
	const data = {
		labels: [{% for data in antall_adgr_tid %}"{{ data.label }}",{% endfor %}],
		datasets: [{
			backgroundColor: 'rgb(255, 99, 132)',
			borderColor: 'rgb(255, 99, 132)',
			data: [{% for data in antall_adgr_tid %}{{ data.value|unlocalize }},{% endfor %}],
		}]
	};

	const config = {
		type: 'line',
		data: data,
		options: {
			plugins: {
				legend: false,
			},
		},
	};
	const myChart = new Chart(
	document.getElementById('adgr_chart'),
		config
	);
	</script>

	<hr>

	<p>Data synkroniseres hver natt. Merk at det er et tak på 5000 medlemmer vist i en gruppe.</p>

	<form action="" autocomplete="off">
		<div class="form-group form-inline">
			<input size="30" style="width: 350px;" type="search" value="{{ search_term }}" name="search_term"
			placeholder="AD-gruppenavn inneholder" class="form-control form-control-sm">
			<input type="submit" value="Søk" class="btn btn-primary btn-sm">
		</div>
	</form>


	<table class="tablesorter excel">
		<thead>
			<tr>
				<th>Display name</th>
				<th>Gruppenavn</th>
				<th>PRK-valg?</th>
				<th>Distribusjonsadresse</th>
				<th>Antall direkte medlemmer</th>
			</tr>
		</thead>
		<tbody>
	{% for g in adgrupper %}
		<tr>
			<td>{{g.display_name|default:""}}</td>
			<td><a href="{% url 'adgruppe_detaljer' pk=g.pk %}">{{ g.short }}</a></td>
			<td>
				{% for prk_valg in g.prkvalg.all %}
					{{ prk_valg.skjemanavn.skjematype }} {{ prk_valg.skjemanavn.skjemanavn }} - {{ prk_valg.valgnavn }}<br>
				{% endfor %}
			</td>
			<td>{{g.mail|default:"-"}}</td>
			<td>{{g.member_count}}</td>
		</tr>
	{% empty %}
		<li>Ingen treff</li>
	{% endfor %}
		</tbody>
	</table>


{% endblock hovedinnhold %}