{% extends "index.html" %}
{% load humanize %}
{% load static %}

{% block underoverskrift %}
	CMDB {{ type }} (Felles IKT-plattform)
{% endblock underoverskrift %}

{% block main_content %}
<p>Viser {{ maskiner.count }} maskiner.</p>

<table id="stickyheader" class="table table-sm tablesorter">
	<thead>
		<th>OS hovedversjon</th>
		<th>OS versjonsnummer</th>
		<th>Antall</th>
	</thead>
	<tbody>
	{% for os in maskiner_stats %}
		<tr>
			<td>{{ os.major|default:"Ukjent" }}</td>
			<td>{{ os.minor|default:"Ukjent" }}</td>
			<td>{{ os.count }}</td>
		</tr>
	{% endfor %}
	</tbody>
</table>

	<table id="stickyheader" class="table table-sm tablesorter">
	<thead>
	<tr>
		<th>Maskinnavn</th>
		<th>Portfolio</th>
		<th>Nettverk</th>
		<th>Operativsystem</th>
	</tr>
	</thead>
	<tbody>
	{% for maskin in maskiner %}
	<tr {% if not maskin.active %} style="color: #d6d6d6;" {% endif %}>
		{% url 'ad_details' name=maskin.comp_name as url_ad %}
		<td><a href="{{ url_ad }}">{{ maskin.comp_name }}</a></td>
		<td>{{ maskin.bs_u_service_portfolio }}</td>
		<td>{{ maskin.comp_ip_address }}</td>
		<td>{{ maskin.comp_os|default:"Ukjent" }} {{ maskin.comp_os_version }} {{ maskin.comp_os_service_pack }}</td>


			{% comment %}
			{% if user.is_authenticated %}
			<a target="_blank" href="/admin/systemoversikt/cmdbref/{{ item.pk }}/delete/">
				<img style="width: 8px; margin: 3px;"
				src="{% static 'open-iconic/svg/x.svg' %}" alt="slett"></a>
			{% endif %}

			{{ item.opprettet|date:'Y-m-d' }}
		</td>
		<td>{{ item.sist_oppdatert|date:'Y-m-d' }}</td>
		<td>
			{% if user.is_authenticated %}
			<a target="_blank" href="/admin/systemoversikt/cmdbref/{{ item.pk }}/change/">
				<img style="width: 11px; margin: 3px;"
				src="{% static 'open-iconic/svg/pencil.svg' %}" alt="rediger"></a>
			{% endif %}
			<a href="{% url 'cmdbdevice' pk=item.pk %}">{{ item.navn }}</a>
		</td>
		<td>{{ item.ant_devices }}</td>
		<td>
			{% for system in item.system_cmdbref_prod.all %}
				{% url 'systemdetaljer' pk=system.pk as url_system %}
				<a href="{{ url_system }}">{{ system.systemnavn }}</a> (Produksjon)<br>
			{% endfor %}
			{% for system in item.system_cmdbref.all %}
				{% url 'systemdetaljer' pk=system.pk as url_system %}
				<a href="{{ url_system }}">{{ system.systemnavn }}</a> (Test)<br>
			{% endfor %}
		</td>
		<td>{{ item.get_operational_status_display|default:"-" }}</td>
		<td>{{ item.comments|default:"-"|truncatewords:6 }}</td>
		<td>{{ item.get_environment_display|default:"-" }}</td>
		<td>{{ item.get_kritikalitet_display|default:"-" }}</td>
		<td>{{ item.get_cmdb_type_display }}</td>
		<td>{{ item.u_service_portfolio|default:"-" }}</td>
		<td>{{ item.u_service_availability|default:"-" }}</td>
		<td>{{ item.u_service_operation_factor|default:"-" }}</td>
		<td>{{ item.u_service_complexity|default:"-" }}</td>
		<td>{{ item.comments|default:"-" }}</td>
		{% endcomment %}
	</tr>
	{% endfor %}
	</tbody>
	</table>
{% endblock main_content %}